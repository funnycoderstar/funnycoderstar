---
title: ä¸ºä»€ä¹ˆä½¿ç”¨v-foræ—¶å¿…é¡»æ·»åŠ å”¯ä¸€çš„key?
date: 2018-03-18 15:30:54
tags: vue
type: "tags"
categories: vue
---
![title](//upload-images.jianshu.io/upload_images/1541368-d9be1b3b39abc037?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
<!--more-->

## `v-for`ä¸­çš„`key`

ä½¿ç”¨`v-for`æ›´æ–°å·²æ¸²æŸ“çš„å…ƒç´ åˆ—è¡¨æ—¶,é»˜è®¤ç”¨`å°±åœ°å¤ç”¨`ç­–ç•¥;åˆ—è¡¨æ•°æ®ä¿®æ”¹çš„æ—¶å€™,ä»–ä¼šæ ¹æ®keyå€¼å»åˆ¤æ–­æŸä¸ªå€¼æ˜¯å¦ä¿®æ”¹,å¦‚æœä¿®æ”¹,åˆ™é‡æ–°æ¸²æŸ“è¿™ä¸€é¡¹,å¦åˆ™å¤ç”¨ä¹‹å‰çš„å…ƒç´ ;
æˆ‘ä»¬åœ¨ä½¿ç”¨çš„ä½¿ç”¨ç»å¸¸ä¼šä½¿ç”¨`index`(å³æ•°ç»„çš„ä¸‹æ ‡)æ¥ä½œä¸º`key`,ä½†å…¶å®è¿™æ˜¯ä¸æ¨èçš„ä¸€ç§ä½¿ç”¨æ–¹æ³•;

ä¸¾ä¸ªğŸŒ°

```js
const list = [
    {
        id: 1,
        name: 'test1',
    },
    {
        id: 2,
        name: 'test2',
    },
    {
        id: 3,
        name: 'test3',
    },
]
```
```js
<div v-for="(item, index) in list" :key="index" >{{item.name}}</div>
```
ä¸Šé¢è¿™ç§æ˜¯æˆ‘ä»¬åšé¡¹ç›®ä¸­å¸¸ç”¨åˆ°çš„ä¸€ç§åœºæ™¯,å› ä¸ºä¸åŠ key,vueç°åœ¨ç›´æ¥æŠ¥é”™,æ‰€ä»¥æˆ‘ä½¿ç”¨indexä½œä¸ºkey;ä¸‹é¢åˆ—ä¸¾ä¸¤ç§ç§å¸¸è§çš„æ•°æ®æ›´æ–°æƒ…å†µ

### 1.åœ¨æœ€åä¸€æ¡æ•°æ®åå†åŠ ä¸€æ¡æ•°æ®

```js
const list = [
    {
        id: 1,
        name: 'test1',
    },
    {
        id: 2,
        name: 'test2',
    },
    {
        id: 3,
        name: 'test3',
    },
    {
        id: 4,
        name: 'æˆ‘æ˜¯åœ¨æœ€åæ·»åŠ çš„ä¸€æ¡æ•°æ®',
    },
]
```
æ­¤æ—¶å‰ä¸‰æ¡æ•°æ®ç›´æ¥å¤ç”¨ä¹‹å‰çš„,æ–°æ¸²æŸ“æœ€åä¸€æ¡æ•°æ®,æ­¤æ—¶ç”¨`index`ä½œä¸º`key`,æ²¡æœ‰ä»»ä½•é—®é¢˜;

### 2.åœ¨ä¸­é—´æ’å…¥ä¸€æ¡æ•°æ®
```js
const list = [
    {
        id: 1,
        name: 'test1',
    },
    {
        id: 4,
        name: 'æˆ‘æ˜¯æ’é˜Ÿçš„é‚£æ¡æ•°æ®',
    }
    {
        id: 2,
        name: 'test2',
    },
    {
        id: 3,
        name: 'test3',
    },
]
```
æ­¤æ—¶æ›´æ–°æ¸²æŸ“æ•°æ®,é€šè¿‡`index`å®šä¹‰çš„`key`å»è¿›è¡Œå‰åæ•°æ®çš„å¯¹æ¯”,å‘ç°


```js
ä¹‹å‰çš„æ•°æ®                               ä¹‹åçš„æ•°æ®

key: 0  index: 0 name: test1     key: 0  index: 0 name: test1
key: 1  index: 1 name: test2     key: 1  index: 1 name: æˆ‘æ˜¯æ’é˜Ÿçš„é‚£æ¡æ•°æ®
key: 2  index: 2 name: test3     key: 2  index: 2 name: test2
                                 key: 3  index: 3 name: test3
```
é€šè¿‡ä¸Šé¢æ¸…æ™°çš„å¯¹æ¯”,å‘ç°é™¤äº†ç¬¬ä¸€ä¸ªæ•°æ®å¯ä»¥å¤ç”¨ä¹‹å‰çš„ä¹‹å¤–,å¦å¤–ä¸‰æ¡æ•°æ®éƒ½éœ€è¦é‡æ–°æ¸²æŸ“;

æ˜¯ä¸æ˜¯å¾ˆæƒŠå¥‡,æˆ‘æ˜æ˜åªæ˜¯æ’å…¥äº†ä¸€æ¡æ•°æ®,æ€ä¹ˆä¸‰æ¡æ•°æ®éƒ½è¦é‡æ–°æ¸²æŸ“?è€Œæˆ‘æƒ³è¦çš„åªæ˜¯æ–°å¢çš„é‚£ä¸€æ¡æ•°æ®æ–°æ¸²æŸ“å‡ºæ¥å°±è¡Œäº†

æœ€å¥½çš„åŠæ³•æ˜¯ä½¿ç”¨æ•°ç»„ä¸­ä¸ä¼šå˜åŒ–çš„é‚£ä¸€é¡¹ä½œä¸º`key`å€¼,å¯¹åº”åˆ°é¡¹ç›®ä¸­,å³æ¯æ¡æ•°æ®éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„`id`,æ¥æ ‡è¯†è¿™æ¡æ•°æ®çš„å”¯ä¸€æ€§;ä½¿ç”¨`id`ä½œä¸º`key`å€¼,æˆ‘ä»¬å†æ¥å¯¹æ¯”ä¸€ä¸‹å‘ä¸­é—´æ’å…¥ä¸€æ¡æ•°æ®,æ­¤æ—¶ä¼šæ€ä¹ˆå»æ¸²æŸ“


```js
ä¹‹å‰çš„æ•°æ®                                       ä¹‹åçš„æ•°æ®

key: 1  id: 1 index: 0 name: test1     key: 1  id: 1 index: 0  name: test1
key: 2  id: 2 index: 1 name: test2     key: 4  id: 4 index: 1  name: æˆ‘æ˜¯æ’é˜Ÿçš„é‚£æ¡æ•°æ®
key: 3  id: 3 index: 2 name: test3     key: 2  id: 2 index: 2  name: test2
                                       key: 3  id: 3 index: 3  name: test3
```
ç°åœ¨å¯¹æ¯”å‘ç°åªæœ‰ä¸€æ¡æ•°æ®å˜åŒ–äº†,å°±æ˜¯`id`ä¸º4çš„é‚£æ¡æ•°æ®,å› æ­¤åªè¦æ–°æ¸²æŸ“è¿™ä¸€æ¡æ•°æ®å°±å¯ä»¥äº†,å…¶ä»–éƒ½æ˜¯å°±å¤ç”¨ä¹‹å‰çš„;

åŒç†åœ¨reactä¸­ä½¿ç”¨mapæ¸²æŸ“åˆ—è¡¨æ—¶,ä¹Ÿæ˜¯å¿…é¡»åŠ key,ä¸”æ¨èåšæ³•ä¹Ÿæ˜¯ä½¿ç”¨`id`,ä¹Ÿæ˜¯è¿™ä¸ªåŸå› ;

å…¶å®,çœŸæ­£çš„åŸå› å¹¶ä¸æ˜¯vueå’Œreactæ€ä¹ˆæ€ä¹ˆ,è€Œæ˜¯å› ä¸ºVirtual DOM ä½¿ç”¨Diffç®—æ³•å®ç°çš„åŸå› :

## åŸç†ç®€æ
> vueå’Œreactçš„è™šæ‹ŸDOMçš„Diffç®—æ³•å¤§è‡´ç›¸åŒï¼Œå…¶æ ¸å¿ƒæ˜¯åŸºäºä¸¤ä¸ªç®€å•çš„å‡è®¾ï¼š

1. ä¸¤ä¸ªç›¸åŒçš„ç»„ä»¶äº§ç”Ÿç±»ä¼¼çš„DOMç»“æ„ï¼Œä¸åŒçš„ç»„ä»¶äº§ç”Ÿä¸åŒçš„DOMç»“æ„ã€‚
2. åŒä¸€å±‚çº§çš„ä¸€ç»„èŠ‚ç‚¹ï¼Œä»–ä»¬å¯ä»¥é€šè¿‡å”¯ä¸€çš„idè¿›è¡ŒåŒºåˆ†ã€‚åŸºäºä»¥ä¸Šè¿™ä¸¤ç‚¹å‡è®¾ï¼Œä½¿å¾—è™šæ‹ŸDOMçš„Diffç®—æ³•çš„å¤æ‚åº¦ä»O(n^3)é™åˆ°äº†O(n)ã€‚

å¼•ç”¨[Reactâ€™s diff algorithm](https://calendar.perfplanet.com/2013/diff/ "Permanent Link to Reactâ€™s diff algorithm")ä¸­çš„ä¾‹å­:

![diff1.jpg](https://upload-images.jianshu.io/upload_images/3297464-0848720c71af2123.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
å½“æŸä¸€å±‚æœ‰å¾ˆå¤šç›¸åŒçš„èŠ‚ç‚¹æ—¶ï¼Œä¹Ÿå°±æ˜¯åˆ—è¡¨èŠ‚ç‚¹æ—¶ï¼ŒDiffç®—æ³•çš„æ›´æ–°è¿‡ç¨‹é»˜è®¤æƒ…å†µä¸‹ä¹Ÿæ˜¯éµå¾ªä»¥ä¸ŠåŸåˆ™ã€‚
æ¯”å¦‚ä¸€ä¸‹è¿™ä¸ªæƒ…å†µï¼š
![diff2.jpg](https://upload-images.jianshu.io/upload_images/3297464-ee627869a6714336.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
æˆ‘ä»¬å¸Œæœ›å¯ä»¥åœ¨Bå’ŒCä¹‹é—´åŠ ä¸€ä¸ªFï¼ŒDiffç®—æ³•é»˜è®¤æ‰§è¡Œèµ·æ¥æ˜¯è¿™æ ·çš„ï¼š
![diff3.jpg](https://upload-images.jianshu.io/upload_images/3297464-d912523aac5fd108.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
å³æŠŠCæ›´æ–°æˆFï¼ŒDæ›´æ–°æˆCï¼ŒEæ›´æ–°æˆDï¼Œæœ€åå†æ’å…¥Eï¼Œæ˜¯ä¸æ˜¯å¾ˆæ²¡æœ‰æ•ˆç‡ï¼Ÿ

æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨keyæ¥ç»™æ¯ä¸ªèŠ‚ç‚¹åšä¸€ä¸ªå”¯ä¸€æ ‡è¯†ï¼ŒDiffç®—æ³•å°±å¯ä»¥æ­£ç¡®çš„è¯†åˆ«æ­¤èŠ‚ç‚¹ï¼Œæ‰¾åˆ°æ­£ç¡®çš„ä½ç½®åŒºæ’å…¥æ–°çš„èŠ‚ç‚¹ã€‚
![diff4.jpg](https://upload-images.jianshu.io/upload_images/3297464-650689b4bd4b9eb6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æ‰€ä»¥ä¸€å¥è¯ï¼Œkeyçš„ä½œç”¨ä¸»è¦æ˜¯ä¸ºäº†é«˜æ•ˆçš„æ›´æ–°è™šæ‹ŸDOMã€‚å¦å¤–vueä¸­åœ¨ä½¿ç”¨ç›¸åŒæ ‡ç­¾åå…ƒç´ çš„è¿‡æ¸¡åˆ‡æ¢æ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨åˆ°keyå±æ€§ï¼Œå…¶ç›®çš„ä¹Ÿæ˜¯ä¸ºäº†è®©vueå¯ä»¥åŒºåˆ†å®ƒä»¬ï¼Œå¦åˆ™vueåªä¼šæ›¿æ¢å…¶å†…éƒ¨å±æ€§è€Œä¸ä¼šè§¦å‘è¿‡æ¸¡æ•ˆæœã€‚
## å‚è€ƒ
- [vueå®˜æ–¹æ–‡æ¡£](https://cn.vuejs.org/v2/guide/list.html#%E6%95%B0%E7%BB%84%E6%9B%B4%E6%96%B0%E6%A3%80%E6%B5%8B)
- [reactå®˜æ–¹æ–‡æ¡£](https://reactjs.org/docs/lists-and-keys.html)
- [æ·±åº¦å‰–æï¼šå¦‚ä½•å®ç°ä¸€ä¸ª Virtual DOM ç®—æ³•](https://github.com/livoras/blog/issues/13)